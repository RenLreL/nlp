<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Text Detection - Political Leaning</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  
    <style>
      body {
        background-color: #f0f0f0;
      }

      .chart-container {
        width: 100%; /* Take 100% of the parent's content area */
        height: 90px;
        background-color: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .custom-chart-title {
        font-weight: bold;
        margin-bottom: -15px;
      }

      canvas {
        max-width: 100%;
        max-height: 100%;
      }

  </style>
  
  </head>
  <body>
    <div class="row">
      <div class="col-md-2"></div>

      <div class="col-md-8 mt-4">

        <h1>Text Detection - Political Leaning</h1>

        <div class="input-group mt-4">
          <textarea class="form-control" id="politicalTextarea" aria-label="With textarea" placeholder="Your political text here"></textarea>
        </div>
        <div class="d-flex justify-content-between mt-3 mb-5">
          <button type="button" class="btn" style="background-color: #4BC0C0; color: white;" id="getLeaningButton">Get political leaning</button>
          <button type="button" class="btn" style="background-color: #b80505; color: white;" id="deleteAllButton">Delete input text</button>
        </div>

        <div id="apiResponse" class="mb-5 p-3 border rounded" style="display: none;">
          <h4>Political Leaning:</h4>
          <pre id="responseText"></pre>
        </div>

        <!--Political leanings of different Media-->
        <div class="custom-chart-title mt-5">Medium1</div>
        <div class="chart-container">
          <canvas id="mediumChart1"></canvas>
        </div>

        <div class="custom-chart-title">Medium2</div>
        <div class="chart-container">
          <canvas id="mediumChart2"></canvas>
        </div>

        <div class="custom-chart-title">Medium3</div>
        <div class="chart-container">
          <canvas id="mediumChart3"></canvas>
        </div>


      </div>
      <div class="col-md-2"></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    
    <script>
      // Register the datalabels plugin globally
      Chart.register(ChartDataLabels);

      // --- Chart Data & Configuration (Define different data for each chart) ---
      const chartConfigs = [
        {
          id: 'mediumChart1',
          data: [20, 30, 20, 20, 10], // Data for the first chart (Right, Right-Center, Center, Left-Center, Left)
          title: 'Overall Sentiment', // Custom title for this chart
          barThickness: 80, // Adjust as needed for each chart
          maxBarThickness: 80,
          plugins: {
            title: {
                display: false, // Display the title for this specific chart
                text: 'Overall Sentiment',
                position: 'left',
                font: {
                    size: 16,
                    weight: 'bold'
                },
                color: '#333'
            }
          }
        },
        {
          id: 'mediumChart2',
          data: [10, 10, 60, 10, 10], // Different data for the second chart
          title: 'Specific Topic A',
          barThickness: 80,
          maxBarThickness: 80,
          plugins: {
            title: {
                display: false,
                text: 'Specific Topic A',
                position: 'left',
                font: {
                    size: 16,
                    weight: 'bold'
                },
                color: '#333'
            }
          }
        },
        {
          id: 'mediumChart3',
          data: [50, 20, 10, 10, 10], // Different data for the third chart
          title: 'Specific Topic B',
          barThickness: 80,
          maxBarThickness: 80,
          plugins: {
            title: {
                display: false,
                text: 'Specific Topic B',
                position: 'left',
                font: {
                    size: 16,
                    weight: 'bold'
                },
                color: '#333'
            }
          }
        }
      ];

      // --- Function to create a single chart ---
      function createPoliticalLeaningChart(config) {
        const ctx = document.getElementById(config.id).getContext('2d');
        const defaultDatasets = [
            {
                label: 'Right',
                data: [config.data[0]],
                backgroundColor: 'rgba(255, 99, 132, 0.8)',
                stack: 'leaningStack' + config.id, // Ensure unique stack for each chart's bar
                borderColor: '#f0f0f0',
                borderWidth: 1
            },
            {
                label: 'Right-Center',
                data: [config.data[1]],
                backgroundColor: 'rgba(220, 143, 161, 0.8)',
                stack: 'leaningStack' + config.id,
                borderColor: '#f0f0f0',
                borderWidth: 1
            },
            {
                label: 'Center',
                data: [config.data[2]],
                backgroundColor: 'rgba(185, 187, 190, 0.8)',
                stack: 'leaningStack' + config.id,
                borderColor: '#f0f0f0',
                borderWidth: 1
            },
            {
                label: 'Left-Center',
                data: [config.data[3]],
                backgroundColor: 'rgba(120, 175, 213, 0.8)',
                stack: 'leaningStack' + config.id,
                borderColor: '#f0f0f0',
                borderWidth: 1
            },
            {
                label: 'Left',
                data: [config.data[4]],
                backgroundColor: 'rgba(54, 162, 235, 0.8)',
                stack: 'leaningStack' + config.id,
                borderColor: '#f0f0f0',
                borderWidth: 1
            }
        ];

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [config.title], // Use chart title as label for Y-axis
                datasets: defaultDatasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                scales: {
                    x: {
                        stacked: true,
                        min: 0,
                        max: 100,
                        display: false,
                        grid: {
                            display: false
                        },
                        ticks: {
                            display: false
                        }
                    },
                    y: {
                        stacked: true,
                        display: false,
                        grid: {
                            display: false
                        },
                        ticks: {
                            display: false
                        },
                        barThickness: config.barThickness, // Use thickness from config
                        maxBarThickness: config.maxBarThickness,
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    title: config.plugins.title, // Use title from config
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.x + '%';
                            }
                        }
                    },
                    datalabels: {
                        formatter: (value, ctx) => {
                            return value + "%";
                        },
                        color: '#fff',
                        font: {
                            weight: 'bold',
                            size: 14,
                        },
                        anchor: 'center',
                        align: 'center',
                    },
                },
  
            },
        });
      }

      // --- Loop to create all charts ---
      chartConfigs.forEach(config => {
        createPoliticalLeaningChart(config);
      });




      // --- DOM Elements ---
      const textarea = document.getElementById('politicalTextarea');
      const deleteAllBtn = document.getElementById('deleteAllButton');
      const getLeaningBtn = document.getElementById('getLeaningButton'); // Get the new button
      const apiResponseDiv = document.getElementById('apiResponse'); // For displaying response
      const responseTextPre = document.getElementById('responseText'); // For displaying response text


      // --- API Endpoint (IMPORTANT: Replace with your actual API URL) ---
      const API_ENDPOINT = 'http://localhost:5000/predict_leaning'; // Example: Replace with your actual API endpoint


      // --- Event Listeners ---

      // Delete All Button
      deleteAllBtn.addEventListener('click', function() {
          textarea.value = '';
      });


      // Get Political Leaning Button
      getLeaningBtn.addEventListener('click', async function() { // Added 'async' keyword
          const textToAnalyze = textarea.value.trim(); // Get text and remove leading/trailing whitespace

          if (textToAnalyze === '') {
              alert('Please enter some text to analyze.'); // Basic validation
              return; // Stop execution if no text
          }

          // Brief flash of the content to signal that something has happened
          responseTextPre.textContent = ''; // Clear the text
          apiResponseDiv.style.display = 'none'; // Hide the div

          // Disable button to prevent multiple clicks
          getLeaningBtn.disabled = true;
          getLeaningBtn.textContent = 'Analyzing...'; // Provide feedback

          try {
              // 1. Make the API Request
              const response = await fetch(API_ENDPOINT, {
                  method: 'POST', // Use POST for sending data
                  headers: {
                      'Content-Type': 'application/json', // Tell the API we're sending JSON
                      // You might need other headers like API keys if your API requires them
                      // 'Authorization': 'Bearer YOUR_API_KEY'
                  },
                  body: JSON.stringify({ // Convert JavaScript object to JSON string
                      text: textToAnalyze // The data you're sending
                  })
              });

              // 2. Handle the API Response
              if (response.ok) { // Check if the response status is 2xx (e.g., 200 OK)
                  const data = await response.json(); // Parse the JSON response body
                  console.log('API Response:', data); // Log the full response

                  // Display the response to the user
                  responseTextPre.textContent = JSON.stringify(data, null, 2); // Pretty-print JSON
                  apiResponseDiv.style.display = 'block'; // Show the response div

                  // You would typically process 'data' here and update your UI
                  // Example: if data had a 'leaning' property
                  // alert('Political Leaning: ' + data.leaning);

              } else {
                  // Handle HTTP errors (e.g., 404 Not Found, 500 Internal Server Error)
                  const errorText = await response.text(); // Get error message from response body
                  console.error('API Error:', response.status, response.statusText, errorText);
                  responseTextPre.textContent = `Error: ${response.status} ${response.statusText}\n${errorText}`;
                  apiResponseDiv.style.display = 'block';
                  alert(`Failed to get political leaning. Error: ${response.status} ${response.statusText}`);
              }

          } catch (error) {
              // Handle network errors (e.g., no internet, API server down)
              console.error('Network or other error:', error);
              responseTextPre.textContent = `Network or other error: ${error.message}`;
              apiResponseDiv.style.display = 'block';
              alert('An error occurred while connecting to the API. Please check your internet connection or try again later.');
          } finally {
              // This block always executes, regardless of success or failure
              getLeaningBtn.disabled = false; // Re-enable the button
              getLeaningBtn.textContent = 'Get political leaning'; // Reset button text
          }
      });
    </script>

  </body>
</html>